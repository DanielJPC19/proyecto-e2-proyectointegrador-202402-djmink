{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <link rel="stylesheet" href="{% static 'epp1.css' %}">
</head>

<body>
    <div id="editsection" class="editsection">

        <div id="heading" class="heading">

            <div id="rectangleheading" class="rectangleheading"></div>
            <div id="hometext" class="hometext">Home</div>
            <img id="chat_icon" class="chat_icon" src="{% static 'Chat_Icon.png' %}"/>
            <img id="notification_icon" class="notification_icon" src="{% static 'Notification_Icon.png' %}"/>
            <a href="{% url 'perfilFreelancer' p.id %}">
                <img id="profile_picture2" class="profile_picture2" src="{{ p.profile_picture.url }}" alt="Profile Picture"/>
            </a>
            <img id="logo" class="logo" src="{% static 'logo.png' %}"/>
            <div id="logoseparator" class="logoseparator"></div>
        
            <div id="onlinemarketplace2" class="onlinemarketplace2">
                Online Marketplace
            </div>
        </div>

        <div class="ptext ep">
            Edit profile
        </div>     

        <a href="{% url 'editAccount' p.id %}" class="ptext my-account">My account</a>
        <a href="#editProfile" class="ptext profile">Profile</a>
        <a href="#editPortfolio" class="ptext portfolio">Portfolio</a>
        <a href="#deteleaccount" class="ptext delete-account">Delete account</a>       

        <div class="container">

            <div class="ptext profiletitle">
                Profile
            </div>

            <div class="container-pic">
                <img id="profile_picture3" class="profile_picture3" src="{{ p.profile_picture.url }}" alt="Profile Picture"/>
                <div class="ptext name">{{ p.name }}</div>
                <button id='change-picture-button' class='change-picture-button'>
                    <div class='ptext change'>Change profile picture</div>
                </button>
            </div>

            <div class="ptext about-you">
                About you
            </div>

            <div class="input-container-major">
                <div class="ptext about">Major</div>
                <textarea class="input-box major">{{ p.profession }}</textarea>
            </div>

            <div class="input-container-bio">
                <div class="ptext about">Bio</div>
                <textarea class="input-box bio">{{ p.description }}</textarea>
            </div>

            <div class="input-container-mail">
                <div class="ptext about">Contact email</div>
                <textarea class="input-box mail">{{ p.contact_email }}</textarea>
            </div>

            <div class="ptext links">
                Social Media
            </div>

            <div class="social-networks" id="social-networks">
                {% for network in p.social_networks.all %}
                    <div class="container-media" id="social-{{ network.id }}">
                        <img class="media-pic" src="{{ network.image.url }}"/>
                        <textarea class="mediainput">{{ network.url }}</textarea>
                        <button class="delete-btn social" onclick="removeTemporarySocial('{{ network.id }}', '{{ network.type }}')">X</button>
                    </div>
                {% endfor %}
            </div>   

            <div class="ptext add-new-social">
                Add new
            </div>

            <div class="social-selector-container">
                <select name="social-media" id="social-media" onchange="updateSocialMedia()">
                    <option value="">Select Social Media</option>
                    {% for media in available_media %}
                        <option value="{{ media.0 }}">{{ media.1 }}</option>
                    {% empty %}
                        <option>No social media available</option>
                    {% endfor %}
                </select>
            </div>

            <textarea id="user-input" class="newmediainput" style="display: none;"></textarea>
            <img id="selected-icon" src="" alt="Social Media Icon" style="display: none;">
            <button class="add-social-btn" onclick="addSocialNetwork()">+</button>

        </div>
        
        

    </div>

    <script>

        let removedItems = [];  

        // Función para eliminar un elemento temporalmente
        function markForRemoval(itemId) {
            console.log('ID que está llegando a markForRemoval:', itemId);
            // Ocultar el contenedor del elemento
            const element = document.getElementById('social-' + itemId) ||
                            document.getElementById('certificate-' + itemId) ||
                            document.getElementById('hability-' + itemId);
            if (element) {
                element.style.display = 'none';
                removedItems.push(itemId);
            }
        }

        function previewImage(event) {
            var reader = new FileReader();
            reader.onload = function() {
                var output = document.getElementById('profileImage');
                output.src = reader.result;  // Previsualiza la imagen
            };
            reader.readAsDataURL(event.target.files[0]); // Lee el archivo seleccionado
        }

        function updateSocialMedia() {
            const selectElement = document.getElementById('social-media');
            const selectedValue = selectElement.value;
            const userInput = document.getElementById('user-input');
            const iconElement = document.getElementById('selected-icon');

            const urlMap = {
                'facebook': 'facebook.com/',
                'twitter': 'twitter.com/',
                'instagram': 'instagram.com/',
                'linkedin': 'linkedin.com/in/',
                'github': 'github.com/'
            };

            const iconMap = {
                'facebook': "{% static 'fb2.png' %}", 
                'twitter': "{% static 'twitter_icon.jpg' %}",    
                'instagram': "{% static 'ig2.png' %}",
                'linkedin': "{% static 'lin2.png' %}",  
                'github': "{% static 'git.png' %}" 
            };

            if (urlMap[selectedValue]) {
                userInput.value = `www.${urlMap[selectedValue]}your_user`;
                userInput.style.display = 'block';
                iconElement.src = iconMap[selectedValue];
                iconElement.style.display = 'block';
            } else {
                userInput.style.display = 'none'; 
                iconElement.style.display = 'none';
            }
        }

        function addSocialNetwork() {
            const selectElement = document.getElementById('social-media');
            const selectedValue = selectElement.value;
            const userInput = document.getElementById('user-input');
            const socialNetworksContainer = document.getElementById('social-networks');
            const iconElement = document.getElementById('selected-icon');

            // Mapa de URL para cada red social
            const urlMap = {
                'facebook': 'facebook.com/',
                'twitter': 'twitter.com/',
                'instagram': 'instagram.com/',
                'linkedin': 'linkedin.com/in/',
                'github': 'github.com/'
            };

            // Mapa de iconos para cada red social
            const iconMap = {
                'facebook': "{% static 'fb2.png' %}", 
                'twitter': "{% static 'twitter_icon.jpg' %}",    
                'instagram': "{% static 'ig2.png' %}",
                'linkedin': "{% static 'lin2.png' %}",  
                'github': "{% static 'git.png' %}" 
            };

            // Verifica que una red social y un usuario hayan sido seleccionados
            if (selectedValue && userInput.value) {
                console.log(`Adding social network: ${selectedValue} with URL: www.${urlMap[selectedValue]}${userInput.value}`);
                // Crear un nuevo elemento HTML
                const newSocialDiv = document.createElement('div');
                newSocialDiv.classList.add('container-media');

                // Agregar el HTML dinámicamente
                newSocialDiv.innerHTML = `
                    <img class="media-pic" src="${iconMap[selectedValue]}" alt="${selectedValue} icon"/>
                    <textarea class="mediainput">www.${urlMap[selectedValue]}${userInput.value}</textarea>
                    <button class="delete-btn social" onclick="removeTemporarySocial(this, '${selectedValue}')">X</button>
                `;

                // Añadir el nuevo div al contenedor
                socialNetworksContainer.appendChild(newSocialDiv);

                // Eliminar la opción seleccionada del selector
                selectElement.querySelector(`option[value="${selectedValue}"]`).remove();

                // Limpiar el input y el select
                selectElement.value = '';
                userInput.value = '';
                userInput.style.display = 'none';
                iconElement.style.display = 'none';
            }
        }

        // Función para eliminar la red social agregada temporalmente y restaurarla en el selector
        function removeTemporarySocial(element, selectedValue) {
            markForRemoval(element)
            console.log('Elemento:', element);
            console.log('Valor seleccionado:', selectedValue);
            
            // Restaurar la red social eliminada al selector
            const selectElement = document.getElementById('social-media');
            const option = document.createElement('option');
            option.value = selectedValue;
            option.textContent = selectedValue.charAt(0).toUpperCase() + selectedValue.slice(1); // Capitalizar la primera letra
            selectElement.appendChild(option);
        }

    </script>

</body>
